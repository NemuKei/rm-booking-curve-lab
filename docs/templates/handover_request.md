# 引継書の作成依頼（テンプレ）

## 0. 目的（この依頼で作るもの）
- この依頼の成果物は **「引き継ぎ書（本文）」** です（＝次スレッド/次担当が最短で動けることが目的）。
- 引き継ぎ書は **ZIP（make_release_zip.py で作成した最新ZIP）に同梱**し、以後の参照の唯一の正とします。

---

## 1. 入力（必ず添付する）
- 最新の release ZIP（make_release_zip.py で作成したもの）  
  - 例：`rm-booking-curve-lab_YYYYMMDD_HHMM_<branch>_<commit>_full.zip`

---

## 2. 運用ルール（必ず遵守）
※以下は強制です。守れない場合は作業を開始しないでください。

### 2-1. 参照の唯一の正
- 仕様の唯一の正：`docs/spec_*.md` と `AGENTS.md`
- 共有物の唯一の正：**最新ZIP**（単体ファイル添付は原則しない）

### 2-2. 推測禁止
- 判断に必要なファイルが足りていない場合、**推測で埋めずに不足を要求**してください。
- 不足が残る場合、**壁打ちに切り替え**（Codex用プロンプトは出さない）で進めてください。

### 2-3. 参照齟齬防止（品質ゲート）
新スレッド/引継書作成時は、まず ZIP 内で以下を確認し、矛盾がないか検算してください。

1) `docs/thread_logs/` のうち **直近の Thread Log（原則1本）**  
2) `docs/decision_log.md` の末尾（直近 10〜20 件）

矛盾・不明があれば、作業に入る前に「確認質問」を作ってください（最大5つまで）。

### 2-4. 次スレッド冒頭 Docs Gate（必須）
スレッド終盤はトークン溢れで事故りやすいため、**docs更新が必要な場合は「次スレ冒頭の最初の作業」として確実に実施**する。

#### 手順（次スレ冒頭で必ず実施）
1) 最新ZIPを展開し、ZIP名/branch/commit を確認する  
2) `docs/thread_logs/` のうち直近のThread Log（原則1本）を確認する  
3) `docs/decision_log.md` の末尾（直近10〜20件）を確認する  
4) 未反映の決定のうち、**spec_*（仕様の唯一の正）に反映が必要なものがあるか**を判定する  
5) 必要があれば、**実装作業より先に docs（spec_*）更新を行う**（＝Docs Gate）

#### 判定基準（Yes/No）
- Yes（Docs更新が必要）：
  - `decision_log` に「spec反映が必要」な未反映項目がある
  - Thread Log に「docs更新が残」と明記されている
  - 仕様（spec_*）と実装の乖離があり、**運用上の事故リスクがある**
- No（Docs更新不要）：
  - 直近の決定は spec_* に反映済で、未反映は「将来検討」または実装タスクのみ
  - Thread Log と decision_log と spec_* の間に矛盾が見当たらない

※Docs更新が必要なのに後回しにすると、次作業の前提が崩れて事故るため、必ず先に処理する。

---

## 3. 出力先（ファイル化：必須）
- 引き継ぎ本文は **ファイルとして出力**してください。

### 3-1. Proposed file path（必須・1行）
- `Proposed file path: docs/handovers/YYYY-MM-DD_<branch>_<scope>.md`

**命名ルール**
- YYYY-MM-DD：この引継書の作成日
- `<branch>`：例 `main` / `feature-xxxx`
- `<scope>`：短く（例：`docs-align` / `pace14-market` / `release-v0.6.10` など）
- ファイル名は **英数字・ハイフン・アンダースコアのみ**（記号【】：は使わない）

---

## 4. 引継書の構成（この見出し順で出力）
※「引継書本文」は以下の見出し構成を崩さないでください（追記はOK、並び替えはしない）。
※引継書本文は docs/templates/handover_body.md の見出し・順序に完全準拠して出力すること
※出力は docs/handovers/...md として保存できる完成品にすること（連結・補足不要）

### 4-1. スレッド移行宣言（新スレッドに貼る前提の文面）
- このスレッドが何の作業ログか
- 次スレッドで何をやるか（P0だけでOK）

### 4-2. 現在地サマリ（できたこと / 未完）
- できたこと（箇条書き）
- 未完（残課題：箇条書き）

### 4-3. 決定事項（仕様として合意したこと）
- 仕様として合意したこと（Decision Logに対応できる粒度で）

### 4-4. 未解決の課題・バグ
- 再現条件 / 影響範囲 / 暫定回避策（書ける範囲で）
- ここが薄いと次の人が詰むので最重要

### 4-5. 次にやる作業（P0/P1/P2）
- 各タスクに「完了条件」を必ず付ける
- P0は最大2〜3件に絞る（増やすと進まない）

### 4-6. 参照すべきファイル一覧（パス＋理由）
- spec_* / AGENTS / 実装 / logs など

### 4-7. 実行コマンド／手順（分かっている範囲）
- 起動方法、再現手順、ログの場所など

### 4-8. 注意点（参照齟齬・データ・トークン等）
- 「唯一の正」「ZIP運用」「推測禁止」など、運用上の落とし穴を短く

### 4-9. 次スレッドで最初に確認すべきチェックリスト（最大5項目）
- Yes/Noで判断できる形を優先

---

## 5. 引継書の品質条件（必須）
- 「何が終わっていて、何が未完か」が **一読で分かる**
- 「次に何をすればいいか」が **P0として具体的**
- 参照先（spec_* / thread_log / decision_log / 対象コード）が **明確**
- 不明点は推測しない。**不足は不足として明記**されている

---

## 6. 不明点がある場合の質問（最大5つまで）
- Yes/No または短文で答えられる形を優先
- 作業を止めず、最後にまとめて提示する

---

## 7. 出力形式（厳守）
- まず最初に `Proposed file path: ...` を1行で出す
- その後に引継書本文（上記 4-1〜4-9）を **Markdown** で出力
- 余計な前置きや解説は不要（本文だけ）
- 次スレ冒頭で Docs Gate 判定（Yes/No）と、Yesの場合の更新対象 spec_* を明記する