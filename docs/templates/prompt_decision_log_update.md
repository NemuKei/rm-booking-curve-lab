# Decision Log 更新プロンプト（テンプレ）

## 目的
Thread Log から「横断して効く決定」だけを抽出し、`docs/decision_log.md` に追記する **差分（追加エントリのみ）** を作る。

## 重要：Decision Log は仕様ではない
- 仕様の唯一の正：`docs/spec_*.md` と `AGENTS.md`
- Decision Log は「決定の記録」であり、仕様の本体ではない
- 各決定には **spec_* への導線（どのspecに反映が必要か）** を必ず書く

---

## 運用ルール（必ず遵守）
- 推測禁止。不明点は「不足」として最後に質問（最大5つ）
- “会話の流れ”ではなく、将来の改修や運用に影響する決定だけを抽出する
- 個人情報・企業情報・機密が含まれる具体例は書かない（ダミー化）
- 既存エントリの全文再出力は禁止（追加する差分だけ）
- 連番採番（XXX）は **必ず `XXX` のまま**（001等にしない）

---

## 入力（貼り付ける）
- Thread Log（このスレッド分・本文）：<<<ここにThread Log全文を貼る>>>

---

## IDルール（厳守）
- 決定IDは `D-YYYYMMDD-XXX`
- YYYYMMDD は Thread Log の `Meta Date` を使用（例：2026-01-05 → 20260105）
- 連番（XXX）は採番スクリプトが付与するため、必ず `XXX` のまま出力する

---

## Status ルール（運用）
- `Status: 未反映`：spec_* / 実装 / 運用のいずれにも確実に反映されていない（または反映先が未確定）
- `Status: spec反映済`：spec_* に反映済（実装は別扱いでもOK）
- `Status: 実装反映済`：実装に反映済（specは別扱いでもOK）
- `Status: 反映済`：spec_* と実装の両方に反映済
- `Status: 未反映（将来検討）`：採用見送り/保留で、将来の検討項目として残す

※このテンプレは原則「新規決定の追記」を目的とする。既存決定のStatus更新が必要な場合は、最後に「Status更新提案（対象ID一覧＋変更内容）」を別セクションで出す。

---

## 出力フォーマット（厳守）
- **追加するエントリのみ**を Markdown で出す（全文再出力しない）
- 各エントリは以下テンプレで出力する

---

## Decision Log エントリテンプレ（この形で出力）

## D-YYYYMMDD-XXX <短いタイトル>

* Decision:

  * <決定（箇条書き、1〜3行）>
* Why:

  * <理由（1〜3行）>
* Spec link:

  * <docs/spec_*.md: 該当セクション or “なし” を明記>
* Status: 未反映

---

## 追加要求（必須）
- Decision Log の各エントリには「Spec linkage」を必ず書く（spec_* が唯一の正への導線）
- “決定”の粒度が小さすぎる場合は統合してよい（ただし曖昧にしない）
- 不足や矛盾がある場合は、最後に Questions を最大5つまでまとめる

---

## D-20260125-XXX 開発依存（ruff）を pyproject の dev extras で固定し、LFを正として運用する

* Decision:

  * `ruff` は `pyproject.toml` の `optional-dependencies.dev`（`.[dev]`）で導入・固定し、開発環境差を減らす。
  * 改行コードは LF を正とし、`.gitattributes` により正規化する（端末差の温床を減らす）。
* Why:

  * VSCode保存時の自動適用等が「ruff未導入」で崩れるのを防ぎ、環境依存のトラブルを減らすため。
  * CRLF/LF差分によるノイズ（パッチ/レビュー/マージ）を減らすため。
* Spec link:

  * なし（開発運用/環境整備）
* Status: 反映済

---

## D-20260125-XXX capacity 定義は固定室数とし、“ベース小”判定はLT帯別に持つ

* Decision:

  * capacity は「月の販売室数（固定室数）」を採用する（休館/工事反映の有効キャパではなく）。
  * “ベースが小さい”の判定・閾値は、LT0–14（pace14帯）と LT15–45（weekshape帯）で別々に持つ方針とする。
* Why:

  * cap正規化により施設規模差を抑えつつ、帯ごとの挙動差（直近と先行）を分けて安定運用するため。
* Spec link:

  * `docs/spec_models.md`: pace14 / weekshape（“ベース小”救済設計を反映する導線）
* Status: 未反映

---